Scenario:
--------
Most of the times when an ES server is stopped and restarted, and if search queries are fired while the server is starting up, the following issues are seen:
1) {
  "error" : "ClusterBlockException[blocked by: [1/not recovered from gateway];[3/index not recovered];]"
}
2) Once the above error is encountered and the server has started up completely, the search queries which were executing successfully before the stoppage, are not returning results anymore.
 
Steps to setup and reproduce:
------------------------------
1) Ensure ES is running at localhost:9200
2) run ./automate.sh.
   a) This will create an es-test index and load the sample data.
   b) Then it fires a query which returns results correctly. This runs in an infinite loop
3) stop running ./automate.sh
4) run ./break-it.sh. This will keep running the query above from 2b in an infinite loop. Keep it running
5) stop and start ES at localhost:9200
6) You should see the issues listed above. If not repeat step 5. 

Configuration of ES:
--------------------
cluster:
  name: sanyal
gateway: 
  type: fs 
  fs: 
    location:  /Users/sanyal/Documents/workspace/hb_indices 
index: 
  memory:
    enabled: true
  gateway:
    snapshot_interval : 30s
  store: 
    type: niofs
  number_of_shards : 2 
  number_of_replicas : 1 
path:
  home: /Users/sanyal/Installs/elasticsearch
  logs: /Users/sanyal/Documents/workspace/logs 